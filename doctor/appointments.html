<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Appointments & Shifts - MedPulse</title>
  <link rel="stylesheet" href="doctor.css" />
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <h1 class="nav-brand">MedPulse</h1>
      <div class="nav-links">
        <a href="dashboard.html">Dashboard</a>
        <a href="notifications.html">Notifications</a>
        <a href="change-password.html">Change Password</a>
        <a href="#" onclick="logout()">Logout</a>
      </div>
    </div>
  </nav>

  <div class="dashboard-container">
    <div class="page-tabs">
      <button class="tab-btn active" onclick="showTab('appointments')">My Appointments</button>
      <button class="tab-btn" onclick="showTab('shifts')">My Shifts</button>
    </div>

    <div id="appointments-tab" class="tab-content active">
      <h2>My Appointments</h2>
      <div class="table-section">
        <table class="data-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Time</th>
              <th>Patient</th>
              <th>Reason</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="appointments-list">
            <!-- Appointments will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>

    <div id="shifts-tab" class="tab-content">
      <h2>My Shifts</h2>
      <div class="table-section">
        <table class="data-table">
          <thead>
            <tr>
              <th>Day</th>
              <th>Start Time</th>
              <th>End Time</th>
              <th>Department</th>
            </tr>
          </thead>
          <tbody id="shifts-list">
            <!-- Shifts will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      loadAppointments();
      loadShifts();
    });

    function showTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabName + '-tab').classList.add('active');
      event.target.classList.add('active');
    }

    function loadAppointments() {
      const doctorId = localStorage.getItem('doctorId');
      const appointments = JSON.parse(localStorage.getItem('appointments') || '[]');
      const doctorAppointments = appointments.filter(apt => apt.doctorId === doctorId);
      const patients = JSON.parse(localStorage.getItem('patients') || '[]');
      const tbody = document.getElementById('appointments-list');

      if (doctorAppointments.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No appointments scheduled.</td></tr>';
        return;
      }

      tbody.innerHTML = doctorAppointments.map(apt => {
        const patient = patients.find(p => p.id === apt.patientId);
        return `
          <tr>
            <td>${apt.date || 'N/A'}</td>
            <td>${apt.time || 'N/A'}</td>
            <td>${patient ? (patient.name || patient.patientName) : 'Unknown'}</td>
            <td>${apt.reason || 'N/A'}</td>
            <td><span class="status-badge ${apt.status || 'scheduled'}">${apt.status || 'Scheduled'}</span></td>
            <td>
              <a href="patient-search.html?patientId=${apt.patientId}" class="btn-edit">View Patient</a>
            </td>
          </tr>
        `;
      }).join('');
    }

    function loadShifts() {
      const doctorId = localStorage.getItem('doctorId');
      const shifts = JSON.parse(localStorage.getItem('shifts') || '[]');
      const doctorShifts = shifts.filter(shift => shift.doctorIds && shift.doctorIds.includes(doctorId));
      const departments = JSON.parse(localStorage.getItem('departments') || '[]');
      const tbody = document.getElementById('shifts-list');

      if (doctorShifts.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No shifts assigned.</td></tr>';
        return;
      }

      tbody.innerHTML = doctorShifts.map(shift => {
        const dept = departments.find(d => d.id === shift.departmentId);
        return `
          <tr>
            <td>${shift.day || 'N/A'}</td>
            <td>${shift.startTime || 'N/A'}</td>
            <td>${shift.endTime || 'N/A'}</td>
            <td>${dept ? dept.name : 'Unknown'}</td>
          </tr>
        `;
      }).join('');
    }

    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        localStorage.removeItem('doctorLoggedIn');
        localStorage.removeItem('doctorId');
        window.location.href = '../index.html';
      }
    }
  </script>
</body>
</html>

